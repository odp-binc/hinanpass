// Copyright (c) 2012 Florian H., https://github.com/js-coder/x18n
(function(){var f;f=(function(){var e;e={is:function(a,b){return Object.prototype.toString.call(b).match(/\s(\w+)/)[1].toLowerCase()===a},isPlainObject:function(a){return!!a&&e.is('object',a)},toArray:function(a){if(e.is('array',a)){return a}else{return[a]}}};function f(a){var b,key,_ref;if(a==null){a={}}a.__observable={lastIds:{},events:{},ids:[]};_ref=f.prototype;for(key in _ref){b=_ref[key];a[key]=b}return a}f.prototype.on=function(a,b,c){var d,topic,_base,_base1,_i,_len;if(e.isPlainObject(a)){c=b;for(topic in a){b=a[topic];this.on(topic,b,c)}}else{a=e.toArray(a);this.__observable.ids.length=0;for(_i=0,_len=a.length;_i<_len;_i++){topic=a[_i];(_base=this.__observable.lastIds)[topic]||(_base[topic]=0);d=""+topic+";"+(++this.__observable.lastIds[topic]);if(c){d+=' once'}this.__observable.ids.push(d);(_base1=this.__observable.events)[topic]||(_base1[topic]={});this.__observable.events[topic][d]=b}}return this};f.prototype.once=function(a,b){return this.on(a,b,true)};f.prototype.off=function(a){var b,topic,_i,_len,_ref;if(a===void 0){this.__observable.events={}}else{_ref=a.__observable.ids;for(_i=0,_len=_ref.length;_i<_len;_i++){b=_ref[_i];topic=b.substr(0,b.lastIndexOf(';')).split(' ')[0];if(a.__observable.events[topic]){delete a.__observable.events[topic][b]}}}return this};f.prototype.trigger=function(a,b){var c,id,_ref;if(b==null){b=[]}_ref=this.__observable.events[a];for(id in _ref){c=_ref[id];c.apply(null,b);if(id.lastIndexOf(' once')===id.length-1){this.off(id)}}return this};return f})();if(typeof define==='function'&&define.amd){define('observable',[],function(){return f})}else if(typeof exports!=='undefined'){module.exports=f}else{window.Observable=f}}).call(this);(function(){var g,__slice=[].slice,__indexOf=[].indexOf||function(a){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===a)return i}return-1};g=function(e){var f;return f=(function(){var d,oldT;function f(){}f.dict={};f.defaultlocal='en';f.chosenLocal=void 0;f.availableLocales=[];f.locales=[];f.dynamicBindings=true;f.missingTranslations={};d=new e;f.__observable=d.__observable;f.on=d.on;f.once=d.once;f.off=d.off;f.trigger=d.trigger;f.utils={merge:function(a,b){var k,v,_results;_results=[];for(k in b){v=b[k];if(typeof v==='object'&&typeof a[k]==='object'){_results.push(this.merge(a[k],v))}else{_results.push(a[k]=v)}}return _results},filter:function(a,b){var v,_i,_len,_results;_results=[];for(_i=0,_len=a.length;_i<_len;_i++){v=a[_i];if(b(v)){_results.push(v)}}return _results},unique:function(a){var k,ret,v,_i,_len,_results;ret={};for(_i=0,_len=a.length;_i<_len;_i++){v=a[_i];ret[v]=v}_results=[];for(k in ret){v=ret[k];_results.push(v)}return _results},getByDotNotation:function(a,b){var c;c=b.split('.');while(!(c.length===0||a===void 0)){a=a[c[0]];c.shift()}return a},isPlainObject:function(a){return!!a&&Object.prototype.toString.call(a)==='[object Object]'}};f.register=function(a,b){if(!(a in this.dict)){this.dict[a]={};this.availableLocales.push(a)}this.utils.merge(this.dict[a],b);return this.trigger('dict:change')};f.set=function(a){this.chosenLocal=a;return this.sortLocales()};f.setDefault=function(a){this.defaultLocal=a;return this.sortLocales()};f.detectLocal=function(){return navigator.userLanguage||navigator.language};f.similiarLocales=function(a){a=String(a).slice(0,2).toLowerCase();return this.utils.filter(this.availableLocales,function(l){if(a===l){return false}return l.toLowerCase().indexOf(a)===0})};f.sortLocales=function(){var a,locales,_i,_len,_locales;_locales=[this.chosenLocal].concat(__slice.call(this.similiarLocales(this.chosenLocal)),[this.detectLocal()],__slice.call(this.similiarLocales(this.detectLocal)),[this.defaultlocal],[this.similiarLocales(this.defaultlocal)],['en'],__slice.call(this.similiarLocales('en')));locales=[];for(_i=0,_len=_locales.length;_i<_len;_i++){a=_locales[_i];if(__indexOf.call(this.availableLocales,a)>=0){locales.push(a)}}locales.push.apply(locales,this.availableLocales);this.locales=this.utils.unique(locales);return this.trigger('lang:change')};f.resolveBindings=function(b){b=String(b);if(!this.dynamicBindings){return b}return b.replace(/\$\{([^}]+)\}/g,function(_,a){return f.globalEval(a)})};f.interpolate=function(){var b,str;str=arguments[0],b=2<=arguments.length?__slice.call(arguments,1):[];if(this.utils.isPlainObject(b[0])){str=str.replace(/%\{([^}]+)\}/g,function(_,a){return b[0][a]})}else{str=str.replace(/%(\d+)/g,function(_,n){return b[Number(n)-1]})}return this.resolveBindings(str)};f.globalEval=function(b){return(window.execScript||function(a){return eval.call(window,a)})(b)};oldT=window.t;f.t=function(){var a,key,local,tr,_i,_len,_ref;key=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[];tr=void 0;_ref=f.locales;for(_i=0,_len=_ref.length;_i<_len;_i++){local=_ref[_i];tr=f.utils.getByDotNotation(f.dict[local],key);if(tr){break}else{if(!(local in f.missingTranslations)){f.missingTranslations[local]=[]}f.missingTranslations[local].push(key);f.missingTranslations[local]=f.utils.unique(f.missingTranslations[local]);f.trigger('missing-translation',[local,key])}}if(typeof tr==='string'){tr=f.interpolate.apply(f,[f.resolveBindings(tr)].concat(__slice.call(a)))}else if(tr!==void 0){tr.plural=function(n){n=f.resolveBindings(n);if(n in tr){return tr[n]}else{return f.interpolate(tr.n,n)}}}return tr};f.t.noConflict=function(){window.t=oldT;return f.t};window.t=f.t;f.on('dict:change',function(){return f.sortLocales()});return f}).call(this)};if(typeof define==='function'&&define.amd){define('x18n',['observable'],function(a){return g(a)})}else{window.x18n=g(Observable)}}).call(this);